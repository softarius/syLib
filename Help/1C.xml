<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="http://www.oasis-open.org/docbook/xml/5.0/rng/docbook.rng" schematypens="http://relaxng.org/ns/structure/1.0"?>
<section xml:lang="ru" xmlns="http://docbook.org/ns/docbook"
    xmlns:db="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink">
    <info>
        <title>Интеграция с 1С:Предприятие</title>
    </info>
    <para>Поддерживается экспорт документов типа «Счет», «Накладная» и «Акт выполненных работа» в
        систему 1C:Предприятие 7.7 (Конфигурация "Упрощенная система налогообложения, ред.
        1.3").</para>
    <para>Экспорт осуществляется нажатием на кнопку <inlinemediaobject>
            <imageobject>
                <imagedata fileref="IMG/1c.png"/>
            </imageobject>
        </inlinemediaobject> в окне Документы. При этом запускается <emphasis role="bold"
            >новый</emphasis> экземпляр программы 1С:Предприятие. При этом появляется стандартный
        диалог входа, для выбора информационной базы, а далее - выбора пользователя и ввода пароля. </para>
    <tip>
        <para>Если настроить параметры подключения (см. ниже), то информационная база будет выбрана
            автоматически. Если в реестр ввести имя пользователя, то он будет выбран. </para>
    </tip>
    <note>
        <para>Если пароль пользователя пустой, то диалог ввода пароля не появится вообще и программа
            1C:Предприятие будет запущена без дополнительных диалогов.</para>
    </note>
    <para>В случае успешного запуска предпринимается попытка отправить документ:</para>
    <figure>
        <title>Экспорт документа в 1С:Предприятие</title>
        <mediaobject>
            <imageobject>
                <imagedata fileref="img/docto1C.png" width="95%"/>
            </imageobject>
        </mediaobject>
    </figure>
    <para>
        <orderedlist>
            <listitem>
                <para>По ИНН проверятся наличие контрагента, в случае отсутствия Контрагент
                    создается автоматически (<xref linkend="message1C"></xref>). В качестве кода контрагента используется его
                    ИНН, что является отличительным признаком того, что контрагент создан из
                    программы "Торговая марка". Плательщик для счета и грузополучатель для
                    Реализации устанавливается равным контрагенту.</para>
            </listitem>
            <listitem>
                <para>По номеру проверяется наличие документа с заданным номером. Если такого
                    документа нет, то он создается. По документу Счет в "Торговая марка" создается
                    документ Счет в 1С:Предприятие , по документу Накладная - документ "Реализация".
                    В комментарий записывается название документа. Если же документ есть, то экспорт
                    останавливается с выдачей сообщения "Документ не пустой!".</para>
            </listitem>
            <listitem>
                <para>Экспортируются строки документа. Для каждой строки по названию проверяется
                    наличие элемента номенклатуры. Если номенклатуры нет, то она создается,
                    считается услугой и устанавливается код с префиксом "tm-". Единицы измерения
                    устанавливаются по коду, записанному в поле Код (CODE) словаря Единица
                    измерения. Коды используются по общероссийскому классификатору единиц измерения
                    (ОКЕИ).</para>
            </listitem>
        </orderedlist>
        
        <figure xml:id="message1C">
            <title>Пример сообщений 1С об автоматическом создании контрагента, документа,
                номенклатуры</title>
            <mediaobject>
                <imageobject>
                    <imagedata fileref="img/1cmessage.png"/>
                </imageobject>
            </mediaobject>
        </figure>
    </para>
    <para>Параметры подключения к 1С:Предприятие хранятся в ветви реестра
       <code>HKEY_CURRENT_USER\Software\Yushinin\tm\1С</code>. Поддерживаются следующие параметры:</para>
    <para>
        <itemizedlist>
            <listitem>
                <para>База (строка) - полный путь к информационной базе;</para>
            </listitem>
            <listitem>
                <para>Заставка (логический) - показывать ли заставку при запуске;</para>
            </listitem>
            <listitem>
                <para>Пользователь (строка) - имя пользователя;</para>
            </listitem>
            <listitem>
                <para>Заголовок (строка) - заголовок окна 1С:Предприятие (находится автоматически
                    при первом запуске)</para>
            </listitem>
        </itemizedlist>
    </para>
    <para>
        
    </para>
</section>
